{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Home - Avtokontinent.uz" %}{% endblock %}

{% block content %}

<!-- Optimized Advertisement Banners Carousel (Real Website Style) -->
{% if banners %}
<section class="banner-section mb-4">
    <div class="container-fluid px-0">  <!-- container-fluid va px-0 qo'shildi -->
        <div id="bannersCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3000">
            <div class="carousel-indicators">
                {% for banner in banners %}
                <button type="button" data-bs-target="#bannersCarousel" data-bs-slide-to="{{ forloop.counter0 }}"
                        {% if forloop.first %}class="active" aria-current="true"{% endif %}
                        aria-label="Slide {{ forloop.counter }}"></button>
                {% endfor %}
            </div>

            <div class="carousel-inner">  <!-- rounded-3 olib tashlandi -->
                {% for banner in banners %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                    {% if banner.link %}
                    <a href="{{ banner.link }}" target="_blank" class="d-block">
                    {% endif %}
                        <div class="banner-container position-relative">
                            <img src="{{ banner.image.url }}" class="d-block w-100" alt="{{ banner.title }}"
                                 style="height: 400px; object-fit: cover; object-position: center;">
                            <div class="banner-caption container position-absolute bottom-0 start-50 translate-middle-x pb-4 text-center">
                                <h2 class="banner-title mb-0 text-white bg-dark d-inline-block px-3 py-2 rounded">
                                    {{ banner.title }}
                                </h2>
                                {% if banner.description %}
                                <p class="banner-description mt-2 text-white bg-dark d-inline-block px-2 py-1 rounded d-none d-md-block">
                                    {{ banner.description }}
                                </p>
                                {% endif %}
                            </div>
                        </div>
                    {% if banner.link %}
                    </a>
                    {% endif %}
                </div>
                {% endfor %}
            </div>

            <button class="carousel-control-prev" type="button" data-bs-target="#bannersCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">{% trans "Previous" %}</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#bannersCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">{% trans "Next" %}</span>
            </button>
        </div>
    </div>
</section>
{% endif %}

<!-- Popular Brands Section - 4 on desktop, 2 on mobile -->
<section class="section py-3" id="popular-brands">
    <div class="container">
        <div class="section-header text-center mb-4">
            <h2 class="section-title">{% trans "Popular Brands" %}</h2>
            <p class="section-subtitle d-none d-md-block">{% trans "Shop genuine spare parts from the world's leading automotive brands" %}</p>
        </div>

        <div class="row g-3">
            {% for brand in brands|slice:":8" %}
            <div class="col-6 col-md-3">
                <a href="{% url 'brand_models' brand.slug %}" class="text-decoration-none">
                    <div class="brand-card text-center p-2 h-100">
                        {% if brand.logo %}
                        <img src="{{ brand.logo.url }}" alt="{{ brand.name }}" class="brand-logo img-fluid" style="max-height: 80px;">
                        {% else %}
                        <div class="brand-logo d-flex align-items-center justify-content-center bg-light m-auto" style="height: 80px; width: 80px;">
                            <i class="fas fa-car fa-2x text-primary"></i>
                        </div>
                        {% endif %}
                        <div class="brand-name mt-2">{{ brand.name }}</div>
                        <small class="brand-count text-muted">{{ brand.models.count }} {% trans "models" %}</small>
                    </div>
                </a>
            </div>
            {% empty %}
            <div class="col-12 text-center">
                <p class="text-muted">{% trans "No brands available" %}</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
<!--categoriyalar-->
<section class="section py-3 bg-light" id="categories">
    <div class="container">
        <div class="section-header text-center mb-4">
            <h2 class="section-title">{% trans "Product Categories" %}</h2>
            <p class="section-subtitle d-none d-md-block">{% trans "Browse our comprehensive range of automotive parts and accessories" %}</p>
        </div>

        <div class="row g-3">
            {% for category in categories|slice:":6" %}
            <div class="col-6 col-md-2">
                <a href="{% url 'product_list' %}?category={{ category.slug }}" class="text-decoration-none">
                    <div class="category-card h-100 d-flex flex-column">
                        <div class="category-image-container flex-grow-1 d-flex align-items-center justify-content-center">
                            {% if category.image %}
                                <img src="{{ category.image.url }}" alt="{{ category.name }}"
                                     class="category-image img-fluid">
                            {% else %}
                                <img src="{{ MEDIA_URL }}category_images/default.jpg" alt="Default Category"
                                     class="category-image img-fluid">
                            {% endif %}
                        </div>
                        <div class="category-info p-2 text-center">
                            <div class="category-name fw-bold mb-1">{{ category.name }}</div>
                            <small class="category-count text-muted">{{ category.product_count }} {% trans "items" %}</small>
                        </div>
                    </div>
                </a>
            </div>
            {% empty %}
            <div class="col-12 text-center">
                <p class="text-muted">{% trans "No categories available" %}</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Best Selling Products Section - 5 on desktop, 2 on mobile -->
{% if best_selling %}
<section class="section py-3" id="best-selling">
    <div class="container">
        <div class="section-header text-center mb-4">
            <h2 class="section-title">{% trans "Best Selling Products" %}</h2>
            <p class="section-subtitle d-none d-md-block">{% trans "Top 5 products that our customers love the most" %}</p>
        </div>

        <div class="row g-3">
            {% for product in best_selling|slice:":5" %}
            <div class="col-6 col-md-4 col-lg-3 col-xl-2-4">
                <div class="card product-card h-100 border-0 shadow-sm">
                    <div class="position-relative">
                        <img src="{{ product.main_image.url }}" class="card-img-top p-2" alt="{{ product.name }}" style="height: 180px; object-fit: contain;">
                        <div class="product-badge bestseller">{% trans "Best Seller" %}</div>
                        <div class="product-actions d-none d-md-flex">
                            <button class="btn-action" id="like-btn-{{ product.id }}" onclick="likeProduct({{ product.id }})" data-bs-toggle="tooltip" title="Like">
                                <i class="far fa-heart"></i>
                            </button>
                            <button class="btn-action" id="favorite-btn-{{ product.id }}" onclick="favoriteProduct({{ product.id }})" data-bs-toggle="tooltip" title="Add to Favorites">
                                <i class="far fa-star"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body d-flex flex-column pt-1">
                        <h6 class="card-title">{{ product.name|truncatechars:40 }}</h6>
                        <div class="product-stats small text-muted mb-2">
                            <div class="product-stat">
                                <i class="fas fa-shopping-cart text-success"></i>
                                <span>{{ product.order_count }} {% trans "sold" %}</span>
                            </div>
                            <div class="product-stat">
                                <i class="fas fa-heart text-danger"></i>
                                <span id="like-count-{{ product.id }}">{{ product.like_count }}</span>
                            </div>
                        </div>
                        <div class="mt-auto">
                            <div class="price fw-bold">{{ product.price_uzs|floatformat:0 }} UZS</div>
                            <div class="d-flex gap-2 mt-2">
                                <a href="{{ product.get_absolute_url }}" class="btn btn-primary btn-sm flex-fill">{% trans "View Details" %}</a>
                                <button class="btn btn-outline-secondary btn-sm add-to-cart-{{ product.id }}" onclick="addToCart({{ product.id }})">
                                    <i class="fas fa-shopping-cart"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="text-center mt-4">
            <a href="{% url 'product_list' %}?sort=popular" class="btn btn-outline-primary btn-sm">
                {% trans "View More" %} <i class="fas fa-arrow-right ms-1"></i>
            </a>
        </div>
    </div>
</section>
{% endif %}

<!-- Most Liked Products Section - 4 on desktop, 2 on mobile -->
{% if most_liked %}
<section class="section py-3 bg-light" id="most-liked">
    <div class="container">
        <div class="section-header text-center mb-4">
            <h2 class="section-title">{% trans "Most Liked Products" %}</h2>
            <p class="section-subtitle d-none d-md-block">{% trans "Products that have won the hearts of our customers" %}</p>
        </div>

        <div class="row g-3">
            {% for product in most_liked|slice:":4" %}
            <div class="col-6 col-md-3">
                <div class="card product-card h-100 border-0 shadow-sm">
                    <div class="position-relative">
                        <img src="{{ product.main_image.url }}" class="card-img-top p-2" alt="{{ product.name }}" style="height: 180px; object-fit: contain;">
                        <div class="product-badge most-liked">
                            <i class="fas fa-heart"></i> {{ product.like_count }}
                        </div>
                        <div class="product-actions d-none d-md-flex">
                            <button class="btn-action" id="like-btn-{{ product.id }}" onclick="likeProduct({{ product.id }})" data-bs-toggle="tooltip" title="Like">
                                <i class="far fa-heart"></i>
                            </button>
                            <button class="btn-action" id="favorite-btn-{{ product.id }}" onclick="favoriteProduct({{ product.id }})" data-bs-toggle="tooltip" title="Add to Favorites">
                                <i class="far fa-star"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body d-flex flex-column pt-1">
                        <h6 class="card-title">{{ product.name|truncatechars:40 }}</h6>
                        <div class="product-stats small text-muted mb-2">
                            <div class="product-stat">
                                <i class="fas fa-heart text-danger"></i>
                                <span id="like-count-{{ product.id }}">{{ product.like_count }} {% trans "likes" %}</span>
                            </div>
                            <div class="product-stat">
                                <i class="fas fa-comment text-primary"></i>
                                <span>{{ product.comment_count }} {% trans "reviews" %}</span>
                            </div>
                        </div>
                        <div class="mt-auto">
                            <div class="price fw-bold">{{ product.price_uzs|floatformat:0 }} UZS</div>
                            <div class="d-flex gap-2 mt-2">
                                <a href="{{ product.get_absolute_url }}" class="btn btn-primary btn-sm flex-fill">{% trans "View Details" %}</a>
                                <button class="btn btn-outline-secondary btn-sm add-to-cart-{{ product.id }}" onclick="addToCart({{ product.id }})">
                                    <i class="fas fa-shopping-cart"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="text-center mt-4">
            <a href="{% url 'product_list' %}?sort=popular" class="btn btn-outline-primary btn-sm">
                {% trans "View More" %} <i class="fas fa-arrow-right ms-1"></i>
            </a>
        </div>
    </div>
</section>
{% endif %}

{% block extra_css %}
<style>
    /* Base Styles */
    .section {
        padding: 1.5rem 0;
    }
    .section-header {
        margin-bottom: 1.5rem;
    }
    .section-title {
        font-size: 1.8rem;
        font-weight: 600;
        color: #333;
    }
    .section-subtitle {
        font-size: 1rem;
        color: #6c757d;
    }

    /* Banner Styles (Real Website Style) */
    .banner-section .carousel {
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border-radius: 8px;
        overflow: hidden;
    }
    .banner-section .carousel-inner img {
        object-fit: cover;
    }
    .banner-section .carousel-caption {
        bottom: 20px;
        left: 10%;
        right: 10%;
        background: rgba(0,0,0,0.5);
        padding: 10px;
        border-radius: 5px;
    }
    .banner-title {
        font-size: 1.5rem;
        text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
    }
    .banner-description {
        font-size: 1rem;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
    }
    .carousel-control-prev,
    .carousel-control-next {
        width: 5%;
        opacity: 0.8;
    }
    .carousel-control-prev-icon,
    .carousel-control-next-icon {
        width: 2rem;
        height: 2rem;
    }

    /* Card Styles */
    .brand-card, .category-card {
        border: 1px solid #eee;
        border-radius: 8px;
        transition: all 0.3s ease;
        background: white;
    }
    .brand-card:hover, .category-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .brand-name, .category-name {
        font-weight: 500;
        color: #333;
    }

    /* Product Card Styles */
    .product-card {
        border-radius: 8px;
        transition: all 0.3s ease;
    }
    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
    }
    .product-badge {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
    }
    .product-badge.bestseller {
        background: #dc3545;
    }
    .product-badge.most-liked {
        background: #fd7e14;
    }
    .price {
        color: #0d6efd;
        font-size: 1.1rem;
    }

    /* Custom Grid for 5 items */
    @media (min-width: 1200px) {
        .col-xl-2-4 {
            flex: 0 0 20%;
            max-width: 20%;
        }
    }

    /* Mobile Responsiveness */
    @media (max-width: 768px) {
        .section {
            padding: 1rem 0;
        }
        .section-title {
            font-size: 1.4rem !important;
        }
        .section-subtitle {
            font-size: 0.875rem !important;
        }

        /* Banner adjustments */
        .banner-section .carousel {
            max-height: 200px;
        }
        .banner-section .carousel-inner img {
            height: 200px !important;
        }
        .banner-title {
            font-size: 1.2rem !important;
        }
        .banner-description {
            font-size: 0.9rem !important;
        }

        /* Force 2 items per row on mobile */
        #popular-brands .col-6,
        #categories .col-6,
        #best-selling .col-6,
        #most-liked .col-6 {
            flex: 0 0 50%;
            max-width: 50%;
        }

        /* Adjust card contents */
        .brand-logo, .category-image {
            max-height: 60px !important;
            height: 60px !important;
        }
        .product-card .card-img-top {
            height: 120px !important;
        }
        .brand-name, .category-name {
            font-size: 0.85rem !important;
        }
        .btn-sm {
            font-size: 0.7rem !important;
            padding: 0.25rem 0.5rem !important;
        }

        /* Categories image fix */
        .category-image {
            height: 120px !important;
            object-fit: contain !important;
            border-radius: 0 !important; /* Remove circular background */
        }
    }
</style>
{% endblock %}

{% endblock %}